using UnityEngine;

public class Bonus_Invulnerability : Pickup
{
    [SerializeField] private GameObject invulImpactPrefab;
    [SerializeField] private GameObject invulPrefab;

    protected override void OnTriggerEnter2D(Collider2D other)
    {
        LevelState level = FindObjectOfType<LevelState>();

        if (level.IsDefeat == false && level.IsPassed == false)
        {
            base.OnTriggerEnter2D(other);

            if (other.transform.root.TryGetComponent(out Cart cart) == true)
            {
                // если телега уже неу€звима, удалить эффекты
                if (cart.IsInvuled == true)
                {
                    Invulnerability invul = FindObjectOfType<Invulnerability>();
                    InvulnerabilityImpact invulImpact = FindObjectOfType<InvulnerabilityImpact>();

                    Destroy(invul.gameObject);
                    Destroy(invulImpact.gameObject);
                }

                UI_GameHUD gameHUD = FindObjectOfType<UI_GameHUD>();

                // активаци€ визуального отображени€ времени действи€ бонуса
                gameHUD.transform.GetChild(0).GetChild(4).GetComponent<UI_BonusBar>().ResetBar();
                gameHUD.transform.GetChild(0).GetChild(4).gameObject.SetActive(true);

                Instantiate(invulImpactPrefab);
                Instantiate(invulPrefab);

                cart.IsInvuled = true;
            }
        }
    }
}